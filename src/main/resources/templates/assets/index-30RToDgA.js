import{F as i,r as g,g as V,j as e,T as l,h as P,i as v,E as S,D as b,k as u,l as k,s as C,I as x,A as $,m as w}from"./vendor-7SbI7Aem.js";import{u as A,b as R,a as _,j as p,n as j,c as B}from"./types-lAkVZ-oF.js";function L(){var f;const{data:o,mutate:d,isLoading:E}=A(j),[r]=i.useForm(),[a]=i.useForm(),[N,c]=g.useState(!1),[O,m]=g.useState(!1),T=t=>e.jsx(v,{rowKey:"id",columns:[{title:"命令",dataIndex:"command"},{title:"描述",dataIndex:"description"},{title:"端口",dataIndex:"port"},{title:"操作",render:(s,n)=>e.jsxs("div",{className:"space-x-10",children:[e.jsx(l,{title:"删除服务",children:e.jsx(b,{onClick:()=>{u.confirm({title:"是否删除服务?",icon:e.jsx(k,{}),onOk(){p(`${j}/${n.id}`,"DELETE").then(()=>{C.success("删除成功"),d(),c(!1)})}})}})}),e.jsx(l,{title:"编辑服务",children:e.jsx(S,{onClick:()=>{a.setFieldsValue({...n,npmProjectId:t.id}),m(!0)}})})]})}],dataSource:t.nodeServers,pagination:!1}),y=a.getFieldValue("npmProjectId"),h=(f=o==null?void 0:o.find(t=>t.id===y))==null?void 0:f.path,{data:F}=V(h?`${R}/io/read?path=${encodeURIComponent(`${h}/package.json`)}`:void 0,_);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-center items-center h-8 ",children:[e.jsx("h2",{className:"mr-auto",children:"项目管理"}),e.jsx(l,{title:"增加npmProject",placement:"leftBottom",children:e.jsx(P,{onClick:()=>{r.setFieldsValue({path:"",description:""}),c(!0)}})})]}),o!==void 0&&e.jsx(v,{rowKey:"id",dataSource:o,loading:E,pagination:!1,expandable:{expandedRowRender:T,defaultExpandAllRows:!0},columns:[{dataIndex:"path",title:"地址"},{dataIndex:"description",title:"描述"},{title:"操作",render:(t,s)=>e.jsxs("div",{className:"space-x-5",children:[e.jsx(l,{title:"添加nodeServer到所属项目",children:e.jsx(P,{onClick:()=>{a.resetFields(),a.setFieldsValue({npmProjectId:s.id}),m(!0)}})}),e.jsx(l,{title:"编辑项目",children:e.jsx(S,{onClick:()=>{r.setFieldsValue(s),c(!0)}})}),e.jsx(l,{title:"删除项目",children:e.jsx(b,{onClick:()=>{u.confirm({title:"是否删除项目?",icon:e.jsx(k,{}),content:"同时删除拥有的服务",onOk(){p(`${j}/${s.id}`,"DELETE").then(()=>{C.success("删除成功"),d()})}})}})})]})}]}),e.jsxs(u,{open:N,title:r.getFieldValue("id")===void 0?"新建项目":"编辑项目",okButtonProps:{autoFocus:!0,htmlType:"submit"},onCancel:()=>c(!1),destroyOnClose:!0,modalRender:t=>e.jsx(i,{layout:"vertical",form:r,name:"form_in_modal",onFinish:s=>{let n=s.path.trim();n=n.replace(/\\+/g,"/").replace(/\/+/g,"/");const I=r.getFieldValue("id");p(j,I?"PUT":"POST",{...s,id:I,path:n}).then(()=>d())},children:t}),children:[e.jsx(i.Item,{name:"path",label:"文件夹地址",rules:[{required:!0,message:"文件夹地址不能为空"}],children:e.jsx(x,{})}),e.jsx(i.Item,{name:"description",label:"名称或描述",children:e.jsx(x,{})})]}),e.jsxs(u,{open:O,title:a.getFieldValue("id")===void 0?"新建node服务":"编辑node服务",okButtonProps:{autoFocus:!0,htmlType:"submit"},onCancel:()=>m(!1),destroyOnClose:!0,modalRender:t=>e.jsx(i,{layout:"vertical",form:a,name:"form_in_modal",onFinish:s=>{const n=a.getFieldValue("id");p(B,n!==void 0?"PUT":"POST",{...s,id:n,npmProjectId:a.getFieldValue("npmProjectId")}).then(()=>{d(),m(!1)})},children:t}),children:[e.jsx(i.Item,{name:"command",label:"命令",rules:[{required:!0,message:"命令不能为空"}],children:e.jsx($,{options:F?Object.keys(JSON.parse(F).scripts).reduce((t,s)=>(t.push({label:s,value:`npm run ${s}`}),t),[]):[]})}),e.jsx(i.Item,{name:"port",label:"端口",rules:[{required:!0,message:"端口不能为空"}],children:e.jsx(w,{min:1024,max:49151})}),e.jsx(i.Item,{name:"description",label:"名称或描述",children:e.jsx(x,{})})]})]})}export{L as default};
