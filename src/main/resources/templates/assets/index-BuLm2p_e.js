import{u as ne,j as e,C as X,B as g,S as O,r as v,F as C,I as k,a as Y,s as P,b as me,M as L,E as he,T as b,P as Z,c as fe,d as ee,D as ge,e as ve,f as xe,R as je,g as Se,h as Re,i as Ce,k as ye,L as te,l as Ee,m as we,n as se,N as Pe}from"./vendor-bv2W42_R.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&c(o)}).observe(document,{childList:!0,subtree:!0});function l(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(i){if(i.ep)return;i.ep=!0;const a=l(i);fetch(i.href,a)}})();const Ie="modulepreload",Ne=function(t){return"/"+t},re={},B=function(n,l,c){let i=Promise.resolve();if(l&&l.length>0){const a=document.getElementsByTagName("link");i=Promise.all(l.map(o=>{if(o=Ne(o),o in re)return;re[o]=!0;const f=o.endsWith(".css"),j=f?'[rel="stylesheet"]':"";if(!!c)for(let w=a.length-1;w>=0;w--){const S=a[w];if(S.href===o&&(!f||S.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${j}`))return;const y=document.createElement("link");if(y.rel=f?"stylesheet":Ie,f||(y.as="script",y.crossOrigin=""),y.href=o,document.head.appendChild(y),f)return new Promise((w,S)=>{y.addEventListener("load",w),y.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${o}`)))})}))}return i.then(()=>n()).catch(a=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a})},q="http://localhost:9981",oe=()=>ne(`${q}/api/npmProjects`),Oe=[{name:"UiServer",value:{name:"UI-Server",portConfigFileRelativePath:".env",portReg:"RENDER_SERVER_PORT\\s*=\\s*(\\d+)",command:"npm run devserver",postServers:[]}},{name:"BffServer",value:{name:"BFF-Server",portConfigFileRelativePath:".env",portReg:"BFF_SERVER_PORT\\s*=\\s*(\\d+)",command:"npm run devserver",postServers:[]}},{name:"BuildServer",value:{portConfigFileRelativePath:"project.js",portReg:"port:\\s*(\\d+)",command:"npm run build",postServers:[]}}];function ke({rootNodeServerStates:t,updateRootNodeServerStates:n,nodeServerState:l}){const[c,i]=v.useState(),{data:a}=oe(),[o]=C.useForm();return v.useEffect(()=>{l.form=o},[l,o]),e.jsxs(C,{form:o,layout:"horizontal",initialValues:l,children:[e.jsx(C.Item,{name:"name",label:"åç§°",rules:[{required:!0,message:"è¾“å…¥æœåŠ¡åç§°"}],children:e.jsx(k,{})}),e.jsx(C.Item,{name:"command",label:"npm å‘½ä»¤",rules:[{required:!0,message:"è¾“å…¥npmå¯åŠ¨å‘½ä»¤"},{pattern:/^npm /,message:"ä»¥npm å¼€å¤´"}],children:e.jsx(k,{})}),e.jsx(C.Item,{name:"npmProjectId",label:"æ‰€å±žé¡¹ç›®",rules:[{required:!0,message:"è¾“å…¥npmå¯åŠ¨å‘½ä»¤"}],children:e.jsx(Y,{value:c,onChange:i,children:a==null?void 0:a.map(f=>e.jsx(Y.Option,{value:f.id,children:f.path},f.id))})}),e.jsx(C.Item,{name:"portConfigFileRelativePath",label:"porté…ç½®æ–‡ä»¶ç›¸å¯¹åœ°å€",rules:[{required:!0,message:"è¾“å…¥porté…ç½®æ–‡ä»¶ç›¸å¯¹åœ°å€"}],children:e.jsx(k,{})}),e.jsx(C.Item,{name:"portReg",label:"porté…ç½®æ–‡ä»¶æ­£åˆ™",rules:[{required:!0,message:"è¾“å…¥æ­£åˆ™"},{validator:(f,j)=>{try{return new RegExp(String(j)),Promise.resolve()}catch{return Promise.reject(new Error("not valid RegExp"))}}}],children:e.jsx(k,{placeholder:"è¾“å…¥æ­£åˆ™ï¼Œå¿…é¡»åŒ…å«æ‹¬å·ä»¥èŽ·å–ç«¯å£"})}),e.jsx(C.Item,{label:"å­æœåŠ¡",children:e.jsx("div",{style:{display:"flex",flexDirection:"column",rowGap:16},children:e.jsx(ae,{nodeServerStates:l.postServers??[],prevNodeServerState:l,rootNodeServerStates:t,updateRootNodeServerStates:n})})})]})}let Le=0;function ae({rootNodeServerStates:t,updateRootNodeServerStates:n,nodeServerStates:l,prevNodeServerState:c}){const i=()=>{let a=[...l],o=c;for(;o;){o.postServers=a;const f=o.prevServer,j=(f==null?void 0:f.postServers)??t;j[j.indexOf(o)]={...o},a=[...j],o=f}n(a)};return e.jsxs(X,{children:[l.map((a,o)=>e.jsxs(X,{className:"cm1s535",children:[e.jsx(ke,{nodeServerState:a,updateRootNodeServerStates:n,rootNodeServerStates:t},a.id??a.tmpId),e.jsx(g,{onClick:()=>{l.splice(o,1),i()},children:"åˆ é™¤æœåŠ¡"})]})),e.jsx(O,{className:"c1lck55g",children:Oe.map(a=>e.jsxs(g,{type:"primary",onClick:()=>{l.push({...a.value,tmpId:`tmp${Le++}`,prevServer:c}),i()},children:[a.name,"æ¨¡æ¿"]}))})]})}var E=(t=>(t.CLOSED="CLOSED",t.COMPILING="COMPILING",t.ERROR="ERROR",t.SUCCESS="SUCCESS",t.UNKNOWN="UNKNOWN",t))(E||{});function be(t,n=500){const[l,c]=v.useState(t);return v.useLayoutEffect(()=>{const i=window.setTimeout(()=>c(t),n);return()=>window.clearTimeout(i)},[t,n]),l}function Te({value:t,onChange:n,...l}){const[c,i]=v.useState(t),a=be(c);return v.useEffect(()=>{n(a)},[n,a]),e.jsx(k,{...l,value:c,onChange:o=>{var f;i((f=o.target.value)==null?void 0:f.trim())}})}const Fe="http://localhost:9981",R=async(t,n,l)=>{try{const c=await window.fetch(`${Fe}${t}`,{method:n,...l&&{body:typeof l=="string"?l:JSON.stringify(l)},headers:{"Content-Type":"application/json"}}),i=await c.json();if(c.status!==200)throw new Error(i==null?void 0:i.data);return i.data}catch(c){throw P.error(c==null?void 0:c.message),c}};function Me({nodes:t}){return console.log("refresh"),e.jsx("pre",{className:"c19i87wg",children:t})}const _e=v.memo(Me,(t,n)=>(console.log("----props---"),console.log(t.rawLogs),console.log(n.rawLogs),console.log(n.rawLogs===t.rawLogs),n.rawLogs===t.rawLogs));function $e(){var z,H,J;const{data:t,mutate:n}=oe(),[l,c]=v.useState([]),{nodeIdMapNodeServerResponse:i,rootNodeServerResponses:a}=v.useMemo(()=>{const r={},s={},d=[],u=[];return t==null||t.forEach(m=>{m.nodeServers.forEach(h=>{const p={...h};p.portConfigFileRelativePath=decodeURIComponent(p.portConfigFileRelativePath),p.portReg=decodeURIComponent(p.portReg);const x={...p,postServers:[]};r[p.id]=x,s[p.id]=p,p.prevServerId||(u.push(p),d.push(x))})}),Object.values(r).forEach(m=>{var p;const h=m;h.prevServer=h.prevServerId?r[h.prevServerId]:void 0,h.postServers=((p=h.postServerIds)==null?void 0:p.map(x=>r[x]))??[]}),c(d),{rootNodeServerResponses:u,nodeIdMapNodeServerResponse:s}},[t]),[o,f]=v.useState(null),[j,T]=v.useState(!1),[y,w]=v.useState({}),{data:S,mutate:G}=ne(`${q}/api/nodeServers/runningInfos`,{revalidateIfStale:!1,revalidateOnMount:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1,onSuccess:async r=>{const s=Object.keys(r),d=await Promise.all(s.map(m=>fetch(`${q}/api/nodeServers/logs/${m}`,{method:"GET"}).then(h=>{var p,x;return(x=(p=h.body)==null?void 0:p.getReader())==null?void 0:x.read()}).then(h=>{const p=[];let x="";if(h!=null&&h.value){x=new TextDecoder().decode(h.value).replace(/\[1m/g,"").replace(/\\x1B/g,"").replace(/\[22m/g,"").replace(/\[32m/g,"").replace(/\[33m/g,"").replace(/\[39m/g,"").replace(//g,"");let U=0;x.replace(/ERROR in ([^(]+)\((\d+),(\d+)\)/g,(D,de,ue,pe,Q)=>(p.push(x.slice(U,Q)),U=Q+D.length,p.push(e.jsx(g,{className:"c5s1knt",type:"link",onClick:()=>{R("/api/npmProjects/vscodeError","PUT",encodeURIComponent(`${de}:${ue}:${pe}`))},target:"_blank",children:D})),D)),p.push(x.slice(U))}return[p,x]}))),u={};d.forEach((m,h)=>{const p=s[h];u[p]={rawLogs:m[1],nodes:m[0]}}),w(u)}}),F=(r,s)=>R(`/api/nodeServers/${r}/${s}`,"PUT").then(()=>{P.success(`${r}æŒ‡ä»¤å·²å‘é€`)}),K=(r,s)=>{var m,h;let d="",u="processing";if(!S||r===void 0||r===null||((m=S[r])==null?void 0:m.status)===void 0)d="æœªå¼€å¯",u="grey";else{const p=(h=S[r])==null?void 0:h.status;switch(p){case E.CLOSED:d="å·²å…³é—­",u="grey";break;case E.ERROR:d="é”™è¯¯",u="error";break;case E.COMPILING:d="ç¼–è¯‘ä¸­..",u="processing";break;case E.SUCCESS:d="æˆåŠŸ",u="success";break;case E.UNKNOWN:d="æœªçŸ¥",u="warning";break;default:{const x=p;throw new Error(x)}}}return e.jsxs(O,{className:"cg3n9dw",children:[e.jsx("div",{children:s??""}),e.jsx(fe,{bordered:!1,color:u,children:d})]})},M=[{title:"åç§°",dataIndex:"name",render:(r,s)=>K(s.id,s.name)},{title:"å‘½ä»¤",dataIndex:"command"},{title:"åœ°å€",render:(r,s)=>{var u;const d=(u=t==null?void 0:t.find(m=>m.id===s.npmProjectId))==null?void 0:u.path;return s.errorField==="PROJECT_PATH"?e.jsx(ee,{title:s.errorMsg,children:e.jsx("span",{className:"c1cph1bk",children:d})}):d}},{title:"ç«¯å£",dataIndex:"port",render:(r,s)=>{if(s.errorMsg)return e.jsx(ee,{title:s.errorMsg,children:e.jsx("span",{className:"c1oriuqi",children:s.errorMsg})});const d=Object.values(i).find(u=>u.id!==s.id&&u.port===r);return e.jsx(Te,{value:r,style:d?{color:"red"}:{},onChange:u=>{String(u)!==String(r)&&R(`/api/nodeServers/changePort/${s.id}/${u}`,"PUT").then(n)}})}},{title:"æ“ä½œ",render:(r,s)=>{const d=S?S[s.id]:null;return e.jsxs(O,{children:[j&&e.jsx(Z,{title:"åˆ é™¤æœåŠ¡",description:"æ˜¯å¦è¦åˆ é™¤æœåŠ¡",onConfirm:()=>{R(`/api/nodeServers/${s.id}`,"DELETE").then(()=>{P.success("åˆ é™¤æˆåŠŸ"),n()})},children:e.jsx(g,{type:"link",children:"åˆ é™¤"})}),!j&&e.jsxs(ge,{disabled:!!s.errorMsg,children:[e.jsx(g,{type:"link",onClick:()=>R(`/api/npmProjects/vscode/${s.npmProjectId}`,"GET"),children:"vscode"}),(!d||d.status===E.CLOSED)&&e.jsx(g,{type:"link",onClick:()=>F("start",s.id).then(()=>{G()}),children:"å¯åŠ¨"}),d&&e.jsxs(e.Fragment,{children:[e.jsx(g,{type:"link",onClick:()=>f(s.id??null),children:"æ—¥å¿—"}),e.jsx(g,{type:"link",onClick:()=>F("restart",s.id).then(()=>{G()}),children:"é‡å¯"}),d.status!==E.CLOSED&&e.jsx(g,{type:"link",onClick:()=>F("stop",s.id),children:"å…³é—­"})]})]})]})}}],le=r=>{var s;return e.jsx(b,{pagination:!1,dataSource:((s=r.nodeServers)==null?void 0:s.map(d=>({...d,key:d.id})))??[],rowKey:"id",columns:M})};function A(r){const{postServerIds:s}=r;if(!s||s.length===0)return null;const d=s.map(u=>({...i[u],key:u}));return e.jsx(b,{pagination:!1,dataSource:d,columns:M,...s.length>0&&{expandable:{expandedRowRender:A,defaultExpandedRowKeys:s}}})}const[ie,I]=v.useState(!1),[_,W]=v.useState(),[N]=C.useForm(),[ce,$]=v.useState(!1);return e.jsxs("div",{children:[e.jsxs(O,{className:"c4u9m77",children:[e.jsx(me,{options:["é¡¹ç›®åˆ†ç»„","æœåŠ¡åˆ†ç»„"],defaultValue:j?"é¡¹ç›®åˆ†ç»„":"æœåŠ¡åˆ†ç»„",onChange:r=>{T(r==="é¡¹ç›®åˆ†ç»„")}}),j&&e.jsxs(e.Fragment,{children:[e.jsx(g,{onClick:()=>{I(!0),N.resetFields()},type:"primary",children:"æ·»åŠ é¡¹ç›®"}),e.jsx(g,{onClick:()=>{$(!0)},type:"primary",children:"æ•´ä½“ç¼–è¾‘æœåŠ¡"})]}),e.jsx(g,{onClick:()=>{L.confirm({title:"æ˜¯å¦å…³é—­æŽ§åˆ¶å°ï¼Ÿ",icon:e.jsx(he,{}),content:"å…³é—­åŽå°è¿è¡Œè¿›ç¨‹",onOk(){R("/api/npmProjects/shutdown","PUT")}})},type:"link",children:"å…³é—­æŽ§åˆ¶å°"})]}),!j&&a.length>0&&e.jsx(b,{pagination:!1,dataSource:a.map(r=>({...r,key:r.id})),columns:M,expandable:{expandedRowRender:A,defaultExpandedRowKeys:a.map(r=>r.id)}}),j&&(t!=null&&t.length)?e.jsx(b,{pagination:!1,dataSource:t.map(r=>({...r,key:r.id})),expandable:{expandedRowRender:le,defaultExpandedRowKeys:t==null?void 0:t.map(r=>r.id)},columns:[{dataIndex:"path",title:"è·¯å¾„"},{title:"æ“ä½œ",render:(r,s)=>e.jsxs(O,{children:[e.jsx(Z,{title:"åˆ é™¤é¡¹ç›®",description:"æ˜¯å¦è¦åˆ é™¤é¡¹ç›®",onConfirm:()=>{R(`/api/npmProjects/${s.id}`,"DELETE").then(()=>{P.success("åˆ é™¤æˆåŠŸ"),n()})},children:e.jsx(g,{type:"link",children:"åˆ é™¤"})}),e.jsx(g,{type:"primary",onClick:()=>{W(s),I(!0),N.setFieldValue("path",s.path)},children:"ç¼–è¾‘"}),e.jsx(g,{type:"primary",onClick:()=>{W(s),I(!0),N.setFieldValue("path",s.path)},children:"æ·»åŠ æœåŠ¡"})]})}]}):null,e.jsx(L,{open:ie,title:`${_?"ç¼–è¾‘":"æ·»åŠ "}é¡¹ç›®`,onCancel:()=>I(!1),onOk:()=>{N.validateFields().then(r=>{if(N.resetFields(),_){R("/api/npmProjects","PUT",{path:r.path,id:_.id}).then(()=>{n(),I(!1),P.success("ä¿®æ”¹é¡¹ç›®æˆåŠŸ")});return}R("/api/npmProjects","POST",r).then(()=>{n(),I(!1),P.success("åˆ›å»ºé¡¹ç›®æˆåŠŸ")})})},children:e.jsx(C,{form:N,layout:"vertical",name:"path",children:e.jsx(C.Item,{name:"path",label:"path",rules:[{required:!0,message:"Please input the path of project"}],children:e.jsx(k,{})})})}),e.jsx(L,{title:"ç¼–è¾‘æˆ–æ·»åŠ æœåŠ¡",open:ce,onCancel:()=>{$(!1)},okText:"ä¿å­˜",cancelText:"å–æ¶ˆ",onOk:()=>{const r=d=>d.map(u=>{var h;const m={...(h=u.form)==null?void 0:h.getFieldsValue(!0)};return m.postServers??(m.postServers=[]),m.portConfigFileRelativePath=encodeURIComponent(m.portConfigFileRelativePath),m.portReg=encodeURIComponent(m.portReg),m.postServers=r(u.postServers),m}),s=r(l);R("/api/nodeServers/batch","POST",s).then(()=>{P.success("ä¿å­˜æœåŠ¡æˆåŠŸ"),n(),$(!1)})},width:"80vw",children:e.jsx(ae,{nodeServerStates:l,rootNodeServerStates:l,updateRootNodeServerStates:c})}),e.jsx(L,{open:o!==null&&S!==void 0,onCancel:()=>f(null),footer:null,title:e.jsxs(O,{className:"c1ru92bi",children:[K(o,o?(z=i[o])==null?void 0:z.name:""),e.jsx(g,{type:"link",onClick:()=>R(`/api/nodeServers/clearLog/${o}`,"GET"),children:"æ¸…é™¤æ—¥å¿—"})]}),width:"80vw",classNames:{body:"bckpddg"},centered:!0,children:e.jsx(_e,{rawLogs:(H=y[o??-1])==null?void 0:H.rawLogs,nodes:(J=y[o??-1])==null?void 0:J.nodes})})]})}const Ue=t=>fetch(t).then(n=>n.json().then(l=>l.data));function De(t){switch(t){case"en-US":return B(()=>import("./en-US-WwZ3Ju4A.js"),__vite__mapDeps([])).then(n=>n.default);case"zh-CN":return B(()=>import("./zh-CN-XVEU3kbj.js"),__vite__mapDeps([])).then(n=>n.default);default:return B(()=>import("./zh-CN-XVEU3kbj.js"),__vite__mapDeps([])).then(n=>n.default)}}const V=ve()(t=>({setLocale:async n=>{const l=await De(n);t({locale:n,messages:l})}})),Be=()=>{const t=V(c=>c.locale),n=V(c=>c.messages),l=V(c=>c.setLocale);return v.useLayoutEffect(()=>{t||l("zh-CN")},[t,l]),!n||!t?null:e.jsx(Re,{locale:t,messages:n,children:e.jsx(Ce,{value:{fetcher:Ue,revalidateOnFocus:!0,revalidateOnMount:!0,revalidateOnReconnect:!0,revalidateIfStale:!1},children:e.jsx(ye,{locale:{locale:t},theme:{token:{colorPrimary:"#7939cb",borderRadius:2,fontSize:16}},children:e.jsx(te,{style:{minHeight:"100vh"},children:e.jsx(te,{children:e.jsx(Ee,{children:e.jsxs(we,{children:[e.jsx(se,{path:"/nodeServerManagement",element:e.jsx($e,{})}),e.jsx(se,{path:"*",element:e.jsx(Pe,{to:"/nodeServerManagement"})})]})})})})})})})};xe(document.getElementById("root")).render(e.jsx(je.StrictMode,{children:e.jsx(Se,{children:e.jsx(Be,{})})}));
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
