import{u as V,j as e,C as z,B as j,S as b,r as v,F as R,I as F,a as H,s as E,b as ae,M as w,E as le,T,P as J,c as ie,d as Q,D as ce,e as de,f as ue,R as pe,g as he,h as me,i as fe,k as ve,L as X,l as xe,m as je,n as Y,N as ge}from"./vendor-bv2W42_R.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))c(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&c(o)}).observe(document,{childList:!0,subtree:!0});function i(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerPolicy&&(s.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?s.credentials="include":l.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(l){if(l.ep)return;l.ep=!0;const s=i(l);fetch(l.href,s)}})();const Se="modulepreload",Re=function(t){return"/"+t},Z={},L=function(r,i,c){let l=Promise.resolve();if(i&&i.length>0){const s=document.getElementsByTagName("link");l=Promise.all(i.map(o=>{if(o=Re(o),o in Z)return;Z[o]=!0;const p=o.endsWith(".css"),m=p?'[rel="stylesheet"]':"";if(!!c)for(let C=s.length-1;C>=0;C--){const y=s[C];if(y.href===o&&(!p||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${m}`))return;const f=document.createElement("link");if(f.rel=p?"stylesheet":Se,p||(f.as="script",f.crossOrigin=""),f.href=o,document.head.appendChild(f),p)return new Promise((C,y)=>{f.addEventListener("load",C),f.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${o}`)))})}))}return l.then(()=>r()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})},q="http://localhost:9981",ee=()=>V(`${q}/api/npmProjects`,{revalidateIfStale:!1,revalidateOnMount:!0,revalidateOnFocus:!1,revalidateOnReconnect:!1}),Ce=[{name:"UiServer",value:{name:"UI-Server",portConfigFileRelativePath:".env",portReg:"RENDER_SERVER_PORT\\s*=\\s*(\\d+)",command:"npm run devserver",postServers:[]}},{name:"BffServer",value:{name:"BFF-Server",portConfigFileRelativePath:".env",portReg:"BFF_SERVER_PORT\\s*=\\s*(\\d+)",command:"npm run devserver",postServers:[]}},{name:"BuildServer",value:{portConfigFileRelativePath:"project.js",portReg:"port:\\s*(\\d+)",command:"npm run build",postServers:[]}}];function ye({rootNodeServerStates:t,updateRootNodeServerStates:r,nodeServerState:i}){const[c,l]=v.useState(),{data:s}=ee(),[o]=R.useForm();return v.useEffect(()=>{i.form=o},[i,o]),e.jsxs(R,{form:o,layout:"horizontal",initialValues:i,children:[e.jsx(R.Item,{name:"name",label:"åç§°",rules:[{required:!0,message:"è¾“å…¥æœåŠ¡åç§°"}],children:e.jsx(F,{})}),e.jsx(R.Item,{name:"command",label:"npm å‘½ä»¤",rules:[{required:!0,message:"è¾“å…¥npmå¯åŠ¨å‘½ä»¤"},{pattern:/^npm /,message:"ä»¥npm å¼€å¤´"}],children:e.jsx(F,{})}),e.jsx(R.Item,{name:"npmProjectId",label:"æ‰€å±žé¡¹ç›®",rules:[{required:!0,message:"è¾“å…¥npmå¯åŠ¨å‘½ä»¤"}],children:e.jsx(H,{value:c,onChange:l,children:s==null?void 0:s.map(p=>e.jsx(H.Option,{value:p.id,children:p.path},p.id))})}),e.jsx(R.Item,{name:"portConfigFileRelativePath",label:"porté…ç½®æ–‡ä»¶ç›¸å¯¹åœ°å€",rules:[{required:!0,message:"è¾“å…¥porté…ç½®æ–‡ä»¶ç›¸å¯¹åœ°å€"}],children:e.jsx(F,{})}),e.jsx(R.Item,{name:"portReg",label:"porté…ç½®æ–‡ä»¶æ­£åˆ™",rules:[{required:!0,message:"è¾“å…¥æ­£åˆ™"},{validator:(p,m)=>{try{return new RegExp(String(m)),Promise.resolve()}catch{return Promise.reject(new Error("not valid RegExp"))}}}],children:e.jsx(F,{placeholder:"è¾“å…¥æ­£åˆ™ï¼Œå¿…é¡»åŒ…å«æ‹¬å·ä»¥èŽ·å–ç«¯å£"})}),e.jsx(R.Item,{label:"å­æœåŠ¡",children:e.jsx("div",{style:{display:"flex",flexDirection:"column",rowGap:16},children:e.jsx(te,{nodeServerStates:i.postServers??[],prevNodeServerState:i,rootNodeServerStates:t,updateRootNodeServerStates:r})})})]})}let Ee=0;function te({rootNodeServerStates:t,updateRootNodeServerStates:r,nodeServerStates:i,prevNodeServerState:c}){const l=()=>{let s=[...i],o=c;for(;o;){o.postServers=s;const p=o.prevServer,m=(p==null?void 0:p.postServers)??t;m[m.indexOf(o)]={...o},s=[...m],o=p}r(s)};return e.jsxs(z,{children:[i.map((s,o)=>e.jsxs(z,{className:"cm1s535",children:[e.jsx(ye,{nodeServerState:s,updateRootNodeServerStates:r,rootNodeServerStates:t},s.id??s.tmpId),e.jsx(j,{onClick:()=>{i.splice(o,1),l()},children:"åˆ é™¤æœåŠ¡"})]})),e.jsx(b,{className:"c1lck55g",children:Ce.map(s=>e.jsxs(j,{type:"primary",onClick:()=>{i.push({...s.value,tmpId:`tmp${Ee++}`,prevServer:c}),l()},children:[s.name,"æ¨¡æ¿"]}))})]})}var k=(t=>(t.CLOSED="CLOSED",t.COMPILING="COMPILING",t.ERROR="ERROR",t.SUCCESS="SUCCESS",t.UNKNOWN="UNKNOWN",t))(k||{});function Pe(t,r=500){const[i,c]=v.useState(t);return v.useLayoutEffect(()=>{const l=window.setTimeout(()=>c(t),r);return()=>window.clearTimeout(l)},[t,r]),i}function Ie({value:t,onChange:r,...i}){const[c,l]=v.useState(t),s=Pe(c);return v.useEffect(()=>{r(s)},[r,s]),e.jsx(F,{...i,value:c,onChange:o=>{var p;l((p=o.target.value)==null?void 0:p.trim())}})}const Ne="http://localhost:9981",S=async(t,r,i)=>{try{const c=await window.fetch(`${Ne}${t}`,{method:r,...i&&{body:typeof i=="string"?i:JSON.stringify(i)},headers:{"Content-Type":"application/json"}}),l=await c.json();if(c.status!==200)throw new Error(l==null?void 0:l.data);return l.data}catch(c){throw E.error(c==null?void 0:c.message),c}};function Oe({rawLogs:t}){const r=v.useRef(""),i=v.useMemo(()=>{console.log("prevLogs: ",r.current.length),console.log("current logs:",t==null?void 0:t.length),console.log(" logs equal: ",t===r.current),r.current=t??"";const c=[];let l=0;return t==null||t.replace(/(?:ERROR in ([^(]+)\((\d+),(\d+)\))|(\berror\b)/gi,(s,o,p,m,P,f)=>(c.push(t.slice(l,f)),l=f+s.length,P?(c.push(e.jsx("span",{className:"c19i87wg",children:P})),s):(c.push(e.jsx(j,{className:"c5s1knt",type:"link",onClick:()=>{S("/api/npmProjects/vscodeError","PUT",encodeURIComponent(`${o}:${p}:${m}`))},target:"_blank",children:s})),s))),t&&c.push(t.slice(l)),c},[t]);return e.jsx("div",{className:"cg3n9dw",children:i})}let M=null;const be=t=>fetch(t,{method:"GET"}).then(r=>r.text()).then(r=>(console.log(` prev: ${M==null?void 0:M.length} new: ${r==null?void 0:r.length}`),M=r,r.replace(/\[1m/g,"").replace(/\\x1B/g,"").replace(/\[22m/g,"").replace(/\[32m/g,"").replace(/\[33m/g,"").replace(/\[39m/g,"").replace(//g,"").replace(/(\x00)+/g,`
`)));function ke(){var W;const{data:t,mutate:r}=ee(),[i,c]=v.useState([]),{nodeIdMapNodeServerResponse:l,rootNodeServerResponses:s}=v.useMemo(()=>{const a={},n={},u=[],d=[];return t==null||t.forEach(h=>{h.nodeServers.forEach(g=>{const x={...g};x.portConfigFileRelativePath=decodeURIComponent(x.portConfigFileRelativePath),x.portReg=decodeURIComponent(x.portReg);const O={...x,postServers:[]};a[x.id]=O,n[x.id]=x,x.prevServerId||(d.push(x),u.push(O))})}),Object.values(a).forEach(h=>{var x;const g=h;g.prevServer=g.prevServerId?a[g.prevServerId]:void 0,g.postServers=((x=g.postServerIds)==null?void 0:x.map(O=>a[O]))??[]}),c(u),{rootNodeServerResponses:d,nodeIdMapNodeServerResponse:n}},[t]),[o,p]=v.useState(null),[m,P]=v.useState(!1),{data:f,mutate:C}=V(`${q}/api/nodeServers/runningInfos`,{...!m&&{refreshInterval:2e3}}),{data:y,mutate:re}=V(o?`${q}/api/nodeServers/logs/${o}`:void 0,be,{...!o!==null&&{refreshInterval:2e3},revalidateIfStale:!0,revalidateOnFocus:!0,revalidateOnMount:!0,revalidateOnReconnect:!0});v.useEffect(()=>{C()},[C]);const $=(a,n)=>S(`/api/nodeServers/${a}/${n}`,"PUT").then(()=>{E.success(`${a}æŒ‡ä»¤å·²å‘é€`)}),G=(a,n)=>{var h,g;let u="",d="processing";if(!f||a===void 0||a===null||((h=f[a])==null?void 0:h.status)===void 0)u="æœªå¼€å¯",d="grey";else{const x=(g=f[a])==null?void 0:g.status;switch(x){case k.CLOSED:u="å·²å…³é—­",d="grey";break;case k.ERROR:u="é”™è¯¯",d="error";break;case k.COMPILING:u="ç¼–è¯‘ä¸­..",d="processing";break;case k.SUCCESS:u="æˆåŠŸ",d="success";break;case k.UNKNOWN:u="æœªçŸ¥",d="warning";break;default:{const O=x;throw new Error(O)}}}return e.jsxs(b,{className:"c1cph1bk",children:[e.jsx("div",{children:n??""}),e.jsx(ie,{bordered:!1,color:d,children:u})]})},_=[{title:"åç§°",dataIndex:"name",render:(a,n)=>G(n.id,n.name)},{title:"å‘½ä»¤",dataIndex:"command"},{title:"åœ°å€",render:(a,n)=>{var d;const u=(d=t==null?void 0:t.find(h=>h.id===n.npmProjectId))==null?void 0:d.path;return n.errorField==="PROJECT_PATH"?e.jsx(Q,{title:n.errorMsg,children:e.jsx("span",{className:"c1oriuqi",children:u})}):u}},{title:"ç«¯å£",dataIndex:"port",render:(a,n)=>{if(n.errorMsg)return e.jsx(Q,{title:n.errorMsg,children:e.jsx("span",{className:"c4u9m77",children:n.errorMsg})});const u=Object.values(l).find(d=>d.id!==n.id&&d.port===a);return e.jsx(Ie,{value:a,style:u?{color:"red"}:{},onChange:d=>{String(d)!==String(a)&&S(`/api/nodeServers/changePort/${n.id}/${d}`,"PUT").then(r)}})}},{title:"æ“ä½œ",render:(a,n)=>{const u=f?f[n.id]:null;return e.jsxs(b,{children:[m&&e.jsx(J,{title:"åˆ é™¤æœåŠ¡",description:"æ˜¯å¦è¦åˆ é™¤æœåŠ¡",onConfirm:()=>{S(`/api/nodeServers/${n.id}`,"DELETE").then(()=>{E.success("åˆ é™¤æˆåŠŸ"),r()})},children:e.jsx(j,{type:"link",children:"åˆ é™¤"})}),!m&&e.jsxs(ce,{disabled:!!n.errorMsg,children:[e.jsx(j,{type:"link",onClick:()=>S(`/api/npmProjects/vscode/${n.npmProjectId}`,"GET"),children:"vscode"}),e.jsx(j,{type:"link",onClick:()=>$("start",n.id).then(()=>C()),children:"å¯åŠ¨"}),e.jsx(j,{type:"link",onClick:()=>{p(n.id??null)},disabled:!u,children:"æ—¥å¿—"}),e.jsx(j,{type:"link",onClick:()=>$("restart",n.id).then(()=>C()),children:"é‡å¯"}),e.jsx(j,{type:"link",onClick:()=>$("stop",n.id),children:"å…³é—­"})]})]})}}],ne=a=>{var n;return e.jsx(T,{pagination:!1,dataSource:((n=a.nodeServers)==null?void 0:n.map(u=>({...u,key:u.id})))??[],rowKey:"id",columns:_})};function K(a){const{postServerIds:n}=a;if(!n||n.length===0)return null;const u=n.map(d=>({...l[d],key:d}));return e.jsx(T,{pagination:!1,dataSource:u,columns:_,...n.length>0&&{expandable:{expandedRowRender:K,defaultExpandedRowKeys:n}}})}const[se,I]=v.useState(!1),[U,A]=v.useState(),[N]=R.useForm(),[oe,D]=v.useState(!1);return e.jsxs("div",{children:[e.jsxs(b,{className:"c1ru92bi",children:[e.jsx(ae,{options:["é¡¹ç›®åˆ†ç»„","æœåŠ¡åˆ†ç»„"],defaultValue:m?"é¡¹ç›®åˆ†ç»„":"æœåŠ¡åˆ†ç»„",onChange:a=>{P(a==="é¡¹ç›®åˆ†ç»„")}}),m&&e.jsxs(e.Fragment,{children:[e.jsx(j,{onClick:()=>{I(!0),N.resetFields()},type:"primary",children:"æ·»åŠ é¡¹ç›®"}),e.jsx(j,{onClick:()=>{D(!0)},type:"primary",children:"æ•´ä½“ç¼–è¾‘æœåŠ¡"})]}),e.jsx(j,{onClick:()=>{w.confirm({title:"æ˜¯å¦å…³é—­æŽ§åˆ¶å°ï¼Ÿ",icon:e.jsx(le,{}),content:"å…³é—­åŽå°è¿è¡Œè¿›ç¨‹",onOk(){S("/api/npmProjects/shutdown","PUT")}})},type:"link",children:"å…³é—­æŽ§åˆ¶å°"})]}),!m&&s.length>0&&e.jsx(T,{pagination:!1,dataSource:s.map(a=>({...a,key:a.id})),columns:_,expandable:{expandedRowRender:K,defaultExpandedRowKeys:s.map(a=>a.id)}}),m&&(t!=null&&t.length)?e.jsx(T,{pagination:!1,dataSource:t.map(a=>({...a,key:a.id})),expandable:{expandedRowRender:ne,defaultExpandedRowKeys:t==null?void 0:t.map(a=>a.id)},columns:[{dataIndex:"path",title:"è·¯å¾„"},{title:"æ“ä½œ",render:(a,n)=>e.jsxs(b,{children:[e.jsx(J,{title:"åˆ é™¤é¡¹ç›®",description:"æ˜¯å¦è¦åˆ é™¤é¡¹ç›®",onConfirm:()=>{S(`/api/npmProjects/${n.id}`,"DELETE").then(()=>{E.success("åˆ é™¤æˆåŠŸ"),r()})},children:e.jsx(j,{type:"link",children:"åˆ é™¤"})}),e.jsx(j,{type:"primary",onClick:()=>{A(n),I(!0),N.setFieldValue("path",n.path)},children:"ç¼–è¾‘"}),e.jsx(j,{type:"primary",onClick:()=>{A(n),I(!0),N.setFieldValue("path",n.path)},children:"æ·»åŠ æœåŠ¡"})]})}]}):null,e.jsx(w,{open:se,title:`${U?"ç¼–è¾‘":"æ·»åŠ "}é¡¹ç›®`,onCancel:()=>I(!1),onOk:()=>{N.validateFields().then(a=>{if(N.resetFields(),U){S("/api/npmProjects","PUT",{path:a.path,id:U.id}).then(()=>{r(),I(!1),E.success("ä¿®æ”¹é¡¹ç›®æˆåŠŸ")});return}S("/api/npmProjects","POST",a).then(()=>{r(),I(!1),E.success("åˆ›å»ºé¡¹ç›®æˆåŠŸ")})})},children:e.jsx(R,{form:N,layout:"vertical",name:"path",children:e.jsx(R.Item,{name:"path",label:"path",rules:[{required:!0,message:"Please input the path of project"}],children:e.jsx(F,{})})})}),e.jsx(w,{title:"ç¼–è¾‘æˆ–æ·»åŠ æœåŠ¡",open:oe,onCancel:()=>{D(!1)},okText:"ä¿å­˜",cancelText:"å–æ¶ˆ",onOk:()=>{const a=u=>u.map(d=>{var g;const h={...(g=d.form)==null?void 0:g.getFieldsValue(!0)};return h.postServers??(h.postServers=[]),h.portConfigFileRelativePath=encodeURIComponent(h.portConfigFileRelativePath),h.portReg=encodeURIComponent(h.portReg),h.postServers=a(d.postServers),h}),n=a(i);S("/api/nodeServers/batch","POST",n).then(()=>{E.success("ä¿å­˜æœåŠ¡æˆåŠŸ"),r(),D(!1)})},width:"80vw",children:e.jsx(te,{nodeServerStates:i,rootNodeServerStates:i,updateRootNodeServerStates:c})}),e.jsx(w,{open:o!==null&&f!==void 0,onCancel:()=>p(null),footer:null,title:e.jsxs(b,{className:"cckpddg",children:[G(o,o?(W=l[o])==null?void 0:W.name:""),e.jsx(j,{type:"link",onClick:()=>S(`/api/nodeServers/clearLog/${o}`,"GET").then(()=>re()),children:"æ¸…é™¤æ—¥å¿—"})]}),width:"80vw",classNames:{body:"bclyprh"},centered:!0,children:e.jsx(Oe,{rawLogs:y},y)})]})}const Fe=t=>fetch(t).then(r=>r.json().then(i=>i.data));function we(t){switch(t){case"en-US":return L(()=>import("./en-US-WwZ3Ju4A.js"),__vite__mapDeps([])).then(r=>r.default);case"zh-CN":return L(()=>import("./zh-CN-XVEU3kbj.js"),__vite__mapDeps([])).then(r=>r.default);default:return L(()=>import("./zh-CN-XVEU3kbj.js"),__vite__mapDeps([])).then(r=>r.default)}}const B=de()(t=>({setLocale:async r=>{const i=await we(r);t({locale:r,messages:i})}})),Te=()=>{const t=B(c=>c.locale),r=B(c=>c.messages),i=B(c=>c.setLocale);return v.useLayoutEffect(()=>{t||i("zh-CN")},[t,i]),!r||!t?null:e.jsx(me,{locale:t,messages:r,children:e.jsx(fe,{value:{fetcher:Fe,revalidateOnFocus:!0,revalidateOnMount:!0,revalidateOnReconnect:!0,revalidateIfStale:!1},children:e.jsx(ve,{locale:{locale:t},theme:{token:{colorPrimary:"#7939cb",borderRadius:2,fontSize:16}},children:e.jsx(X,{style:{minHeight:"100vh"},children:e.jsx(X,{children:e.jsx(xe,{children:e.jsxs(je,{children:[e.jsx(Y,{path:"/nodeServerManagement",element:e.jsx(ke,{})}),e.jsx(Y,{path:"*",element:e.jsx(ge,{to:"/nodeServerManagement"})})]})})})})})})})};ue(document.getElementById("root")).render(e.jsx(pe.StrictMode,{children:e.jsx(he,{children:e.jsx(Te,{})})}));
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
