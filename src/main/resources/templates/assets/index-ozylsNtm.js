import{u as B,j as e,C as W,B as v,S as O,r as x,F as R,I as k,a as z,s as y,b as oe,M as w,E as ae,T as F,P as H,c as ie,d as J,D as le,e as ce,f as de,R as ue,g as pe,h as he,i as me,k as fe,L as Q,l as ve,m as xe,n as X,N as je}from"./vendor-bv2W42_R.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))l(c);new MutationObserver(c=>{for(const i of c)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&l(o)}).observe(document,{childList:!0,subtree:!0});function s(c){const i={};return c.integrity&&(i.integrity=c.integrity),c.referrerPolicy&&(i.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?i.credentials="include":c.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(c){if(c.ep)return;c.ep=!0;const i=s(c);fetch(c.href,i)}})();const ge="modulepreload",Se=function(t){return"/"+t},Y={},U=function(r,s,l){let c=Promise.resolve();if(s&&s.length>0){const i=document.getElementsByTagName("link");c=Promise.all(s.map(o=>{if(o=Se(o),o in Y)return;Y[o]=!0;const u=o.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(!!l)for(let C=i.length-1;C>=0;C--){const E=i[C];if(E.href===o&&(!u||E.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${h}`))return;const j=document.createElement("link");if(j.rel=u?"stylesheet":ge,u||(j.as="script",j.crossOrigin=""),j.href=o,document.head.appendChild(j),u)return new Promise((C,E)=>{j.addEventListener("load",C),j.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${o}`)))})}))}return c.then(()=>r()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},V="http://localhost:9981",Z=()=>B(`${V}/api/npmProjects`,{revalidateIfStale:!1,revalidateOnMount:!0,revalidateOnFocus:!1,revalidateOnReconnect:!1}),Re=[{name:"UiServer",value:{name:"UI-Server",portConfigFileRelativePath:".env",portReg:"RENDER_SERVER_PORT\\s*=\\s*(\\d+)",command:"npm run devserver",postServers:[]}},{name:"BffServer",value:{name:"BFF-Server",portConfigFileRelativePath:".env",portReg:"BFF_SERVER_PORT\\s*=\\s*(\\d+)",command:"npm run devserver",postServers:[]}},{name:"BuildServer",value:{portConfigFileRelativePath:"project.js",portReg:"port:\\s*(\\d+)",command:"npm run build",postServers:[]}}];function Ce({rootNodeServerStates:t,updateRootNodeServerStates:r,nodeServerState:s}){const[l,c]=x.useState(),{data:i}=Z(),[o]=R.useForm();return x.useEffect(()=>{s.form=o},[s,o]),e.jsxs(R,{form:o,layout:"horizontal",initialValues:s,children:[e.jsx(R.Item,{name:"name",label:"åç§°",rules:[{required:!0,message:"è¾“å…¥æœåŠ¡åç§°"}],children:e.jsx(k,{})}),e.jsx(R.Item,{name:"command",label:"npm å‘½ä»¤",rules:[{required:!0,message:"è¾“å…¥npmå¯åŠ¨å‘½ä»¤"},{pattern:/^npm /,message:"ä»¥npm å¼€å¤´"}],children:e.jsx(k,{})}),e.jsx(R.Item,{name:"npmProjectId",label:"æ‰€å±žé¡¹ç›®",rules:[{required:!0,message:"è¾“å…¥npmå¯åŠ¨å‘½ä»¤"}],children:e.jsx(z,{value:l,onChange:c,children:i==null?void 0:i.map(u=>e.jsx(z.Option,{value:u.id,children:u.path},u.id))})}),e.jsx(R.Item,{name:"portConfigFileRelativePath",label:"porté…ç½®æ–‡ä»¶ç›¸å¯¹åœ°å€",rules:[{required:!0,message:"è¾“å…¥porté…ç½®æ–‡ä»¶ç›¸å¯¹åœ°å€"}],children:e.jsx(k,{})}),e.jsx(R.Item,{name:"portReg",label:"porté…ç½®æ–‡ä»¶æ­£åˆ™",rules:[{required:!0,message:"è¾“å…¥æ­£åˆ™"},{validator:(u,h)=>{try{return new RegExp(String(h)),Promise.resolve()}catch{return Promise.reject(new Error("not valid RegExp"))}}}],children:e.jsx(k,{placeholder:"è¾“å…¥æ­£åˆ™ï¼Œå¿…é¡»åŒ…å«æ‹¬å·ä»¥èŽ·å–ç«¯å£"})}),e.jsx(R.Item,{label:"å­æœåŠ¡",children:e.jsx("div",{style:{display:"flex",flexDirection:"column",rowGap:16},children:e.jsx(ee,{nodeServerStates:s.postServers??[],prevNodeServerState:s,rootNodeServerStates:t,updateRootNodeServerStates:r})})})]})}let ye=0;function ee({rootNodeServerStates:t,updateRootNodeServerStates:r,nodeServerStates:s,prevNodeServerState:l}){const c=()=>{let i=[...s],o=l;for(;o;){o.postServers=i;const u=o.prevServer,h=(u==null?void 0:u.postServers)??t;h[h.indexOf(o)]={...o},i=[...h],o=u}r(i)};return e.jsxs(W,{children:[s.map((i,o)=>e.jsxs(W,{className:"cm1s535",children:[e.jsx(Ce,{nodeServerState:i,updateRootNodeServerStates:r,rootNodeServerStates:t},i.id??i.tmpId),e.jsx(v,{onClick:()=>{s.splice(o,1),c()},children:"åˆ é™¤æœåŠ¡"})]})),e.jsx(O,{className:"c1lck55g",children:Re.map(i=>e.jsxs(v,{type:"primary",onClick:()=>{s.push({...i.value,tmpId:`tmp${ye++}`,prevServer:l}),c()},children:[i.name,"æ¨¡æ¿"]}))})]})}var b=(t=>(t.CLOSED="CLOSED",t.COMPILING="COMPILING",t.ERROR="ERROR",t.SUCCESS="SUCCESS",t.UNKNOWN="UNKNOWN",t))(b||{});function Ee(t,r=500){const[s,l]=x.useState(t);return x.useLayoutEffect(()=>{const c=window.setTimeout(()=>l(t),r);return()=>window.clearTimeout(c)},[t,r]),s}function Pe({value:t,onChange:r,...s}){const[l,c]=x.useState(t),i=Ee(l);return x.useEffect(()=>{r(i)},[r,i]),e.jsx(k,{...s,value:l,onChange:o=>{var u;c((u=o.target.value)==null?void 0:u.trim())}})}const Ie="http://localhost:9981",S=async(t,r,s)=>{try{const l=await window.fetch(`${Ie}${t}`,{method:r,...s&&{body:typeof s=="string"?s:JSON.stringify(s)},headers:{"Content-Type":"application/json"}}),c=await l.json();if(l.status!==200)throw new Error(c==null?void 0:c.data);return c.data}catch(l){throw y.error(l==null?void 0:l.message),l}};function Ne({rawLogs:t}){const r=[];let s=0;return t==null||t.replace(/(?:ERROR in ([^(]+)\((\d+),(\d+)\))|(\berror\b)/gi,(l,c,i,o,u,h)=>(r.push(t.slice(s,h)),s=h+l.length,u?(r.push(e.jsx("span",{className:"c19i87wg",children:u})),l):(r.push(e.jsx(v,{className:"c5s1knt",type:"link",onClick:()=>{S("/api/npmProjects/vscodeError","PUT",encodeURIComponent(`${c}:${i}:${o}`))},target:"_blank",children:l})),l))),t&&r.push(t.slice(s)),e.jsx("div",{className:"cg3n9dw",children:r})}const Oe=t=>fetch(t,{method:"GET"}).then(r=>{var s,l;return(l=(s=r.body)==null?void 0:s.getReader())==null?void 0:l.read()}).then(r=>new TextDecoder().decode(r==null?void 0:r.value).replace(/\[1m/g,"").replace(/\\x1B/g,"").replace(/\[22m/g,"").replace(/\[32m/g,"").replace(/\[33m/g,"").replace(/\[39m/g,"").replace(//g,"").replace(/(\x00)+/g,`
`));function be(){var A;const{data:t,mutate:r}=Z(),[s,l]=x.useState([]),{nodeIdMapNodeServerResponse:c,rootNodeServerResponses:i}=x.useMemo(()=>{const a={},n={},p=[],d=[];return t==null||t.forEach(m=>{m.nodeServers.forEach(g=>{const f={...g};f.portConfigFileRelativePath=decodeURIComponent(f.portConfigFileRelativePath),f.portReg=decodeURIComponent(f.portReg);const N={...f,postServers:[]};a[f.id]=N,n[f.id]=f,f.prevServerId||(d.push(f),p.push(N))})}),Object.values(a).forEach(m=>{var f;const g=m;g.prevServer=g.prevServerId?a[g.prevServerId]:void 0,g.postServers=((f=g.postServerIds)==null?void 0:f.map(N=>a[N]))??[]}),l(p),{rootNodeServerResponses:d,nodeIdMapNodeServerResponse:n}},[t]),[o,u]=x.useState(null),[h,T]=x.useState(!1),{data:j,mutate:C}=B(`${V}/api/nodeServers/runningInfos`,{...!h&&{refreshInterval:2e3}}),{data:E,mutate:te}=B(o?`${V}/api/nodeServers/logs/${o}`:void 0,Oe,{...!o!==null&&{refreshInterval:2e3},revalidateIfStale:!0,revalidateOnFocus:!0,revalidateOnMount:!0,revalidateOnReconnect:!0});x.useEffect(()=>{C()},[C]);const M=(a,n)=>S(`/api/nodeServers/${a}/${n}`,"PUT").then(()=>{y.success(`${a}æŒ‡ä»¤å·²å‘é€`)}),q=(a,n)=>{var m,g;let p="",d="processing";if(!j||a===void 0||a===null||((m=j[a])==null?void 0:m.status)===void 0)p="æœªå¼€å¯",d="grey";else{const f=(g=j[a])==null?void 0:g.status;switch(f){case b.CLOSED:p="å·²å…³é—­",d="grey";break;case b.ERROR:p="é”™è¯¯",d="error";break;case b.COMPILING:p="ç¼–è¯‘ä¸­..",d="processing";break;case b.SUCCESS:p="æˆåŠŸ",d="success";break;case b.UNKNOWN:p="æœªçŸ¥",d="warning";break;default:{const N=f;throw new Error(N)}}}return e.jsxs(O,{className:"c1cph1bk",children:[e.jsx("div",{children:n??""}),e.jsx(ie,{bordered:!1,color:d,children:p})]})},_=[{title:"åç§°",dataIndex:"name",render:(a,n)=>q(n.id,n.name)},{title:"å‘½ä»¤",dataIndex:"command"},{title:"åœ°å€",render:(a,n)=>{var d;const p=(d=t==null?void 0:t.find(m=>m.id===n.npmProjectId))==null?void 0:d.path;return n.errorField==="PROJECT_PATH"?e.jsx(J,{title:n.errorMsg,children:e.jsx("span",{className:"c1oriuqi",children:p})}):p}},{title:"ç«¯å£",dataIndex:"port",render:(a,n)=>{if(n.errorMsg)return e.jsx(J,{title:n.errorMsg,children:e.jsx("span",{className:"c4u9m77",children:n.errorMsg})});const p=Object.values(c).find(d=>d.id!==n.id&&d.port===a);return e.jsx(Pe,{value:a,style:p?{color:"red"}:{},onChange:d=>{String(d)!==String(a)&&S(`/api/nodeServers/changePort/${n.id}/${d}`,"PUT").then(r)}})}},{title:"æ“ä½œ",render:(a,n)=>{const p=j?j[n.id]:null;return e.jsxs(O,{children:[h&&e.jsx(H,{title:"åˆ é™¤æœåŠ¡",description:"æ˜¯å¦è¦åˆ é™¤æœåŠ¡",onConfirm:()=>{S(`/api/nodeServers/${n.id}`,"DELETE").then(()=>{y.success("åˆ é™¤æˆåŠŸ"),r()})},children:e.jsx(v,{type:"link",children:"åˆ é™¤"})}),!h&&e.jsxs(le,{disabled:!!n.errorMsg,children:[e.jsx(v,{type:"link",onClick:()=>S(`/api/npmProjects/vscode/${n.npmProjectId}`,"GET"),children:"vscode"}),e.jsx(v,{type:"link",onClick:()=>M("start",n.id).then(()=>C()),children:"å¯åŠ¨"}),e.jsx(v,{type:"link",onClick:()=>{u(n.id??null)},disabled:!p,children:"æ—¥å¿—"}),e.jsx(v,{type:"link",onClick:()=>M("restart",n.id).then(()=>C()),children:"é‡å¯"}),e.jsx(v,{type:"link",onClick:()=>M("stop",n.id),children:"å…³é—­"})]})]})}}],re=a=>{var n;return e.jsx(F,{pagination:!1,dataSource:((n=a.nodeServers)==null?void 0:n.map(p=>({...p,key:p.id})))??[],rowKey:"id",columns:_})};function G(a){const{postServerIds:n}=a;if(!n||n.length===0)return null;const p=n.map(d=>({...c[d],key:d}));return e.jsx(F,{pagination:!1,dataSource:p,columns:_,...n.length>0&&{expandable:{expandedRowRender:G,defaultExpandedRowKeys:n}}})}const[ne,P]=x.useState(!1),[$,K]=x.useState(),[I]=R.useForm(),[se,L]=x.useState(!1);return e.jsxs("div",{children:[e.jsxs(O,{className:"c1ru92bi",children:[e.jsx(oe,{options:["é¡¹ç›®åˆ†ç»„","æœåŠ¡åˆ†ç»„"],defaultValue:h?"é¡¹ç›®åˆ†ç»„":"æœåŠ¡åˆ†ç»„",onChange:a=>{T(a==="é¡¹ç›®åˆ†ç»„")}}),h&&e.jsxs(e.Fragment,{children:[e.jsx(v,{onClick:()=>{P(!0),I.resetFields()},type:"primary",children:"æ·»åŠ é¡¹ç›®"}),e.jsx(v,{onClick:()=>{L(!0)},type:"primary",children:"æ•´ä½“ç¼–è¾‘æœåŠ¡"})]}),e.jsx(v,{onClick:()=>{w.confirm({title:"æ˜¯å¦å…³é—­æŽ§åˆ¶å°ï¼Ÿ",icon:e.jsx(ae,{}),content:"å…³é—­åŽå°è¿è¡Œè¿›ç¨‹",onOk(){S("/api/npmProjects/shutdown","PUT")}})},type:"link",children:"å…³é—­æŽ§åˆ¶å°"})]}),!h&&i.length>0&&e.jsx(F,{pagination:!1,dataSource:i.map(a=>({...a,key:a.id})),columns:_,expandable:{expandedRowRender:G,defaultExpandedRowKeys:i.map(a=>a.id)}}),h&&(t!=null&&t.length)?e.jsx(F,{pagination:!1,dataSource:t.map(a=>({...a,key:a.id})),expandable:{expandedRowRender:re,defaultExpandedRowKeys:t==null?void 0:t.map(a=>a.id)},columns:[{dataIndex:"path",title:"è·¯å¾„"},{title:"æ“ä½œ",render:(a,n)=>e.jsxs(O,{children:[e.jsx(H,{title:"åˆ é™¤é¡¹ç›®",description:"æ˜¯å¦è¦åˆ é™¤é¡¹ç›®",onConfirm:()=>{S(`/api/npmProjects/${n.id}`,"DELETE").then(()=>{y.success("åˆ é™¤æˆåŠŸ"),r()})},children:e.jsx(v,{type:"link",children:"åˆ é™¤"})}),e.jsx(v,{type:"primary",onClick:()=>{K(n),P(!0),I.setFieldValue("path",n.path)},children:"ç¼–è¾‘"}),e.jsx(v,{type:"primary",onClick:()=>{K(n),P(!0),I.setFieldValue("path",n.path)},children:"æ·»åŠ æœåŠ¡"})]})}]}):null,e.jsx(w,{open:ne,title:`${$?"ç¼–è¾‘":"æ·»åŠ "}é¡¹ç›®`,onCancel:()=>P(!1),onOk:()=>{I.validateFields().then(a=>{if(I.resetFields(),$){S("/api/npmProjects","PUT",{path:a.path,id:$.id}).then(()=>{r(),P(!1),y.success("ä¿®æ”¹é¡¹ç›®æˆåŠŸ")});return}S("/api/npmProjects","POST",a).then(()=>{r(),P(!1),y.success("åˆ›å»ºé¡¹ç›®æˆåŠŸ")})})},children:e.jsx(R,{form:I,layout:"vertical",name:"path",children:e.jsx(R.Item,{name:"path",label:"path",rules:[{required:!0,message:"Please input the path of project"}],children:e.jsx(k,{})})})}),e.jsx(w,{title:"ç¼–è¾‘æˆ–æ·»åŠ æœåŠ¡",open:se,onCancel:()=>{L(!1)},okText:"ä¿å­˜",cancelText:"å–æ¶ˆ",onOk:()=>{const a=p=>p.map(d=>{var g;const m={...(g=d.form)==null?void 0:g.getFieldsValue(!0)};return m.postServers??(m.postServers=[]),m.portConfigFileRelativePath=encodeURIComponent(m.portConfigFileRelativePath),m.portReg=encodeURIComponent(m.portReg),m.postServers=a(d.postServers),m}),n=a(s);S("/api/nodeServers/batch","POST",n).then(()=>{y.success("ä¿å­˜æœåŠ¡æˆåŠŸ"),r(),L(!1)})},width:"80vw",children:e.jsx(ee,{nodeServerStates:s,rootNodeServerStates:s,updateRootNodeServerStates:l})}),e.jsx(w,{open:o!==null&&j!==void 0,onCancel:()=>u(null),footer:null,title:e.jsxs(O,{className:"cckpddg",children:[q(o,o?(A=c[o])==null?void 0:A.name:""),e.jsx(v,{type:"link",onClick:()=>S(`/api/nodeServers/clearLog/${o}`,"GET").then(()=>te()),children:"æ¸…é™¤æ—¥å¿—"})]}),width:"80vw",classNames:{body:"bclyprh"},centered:!0,children:e.jsx(Ne,{rawLogs:E})})]})}const ke=t=>fetch(t).then(r=>r.json().then(s=>s.data));function we(t){switch(t){case"en-US":return U(()=>import("./en-US-WwZ3Ju4A.js"),__vite__mapDeps([])).then(r=>r.default);case"zh-CN":return U(()=>import("./zh-CN-XVEU3kbj.js"),__vite__mapDeps([])).then(r=>r.default);default:return U(()=>import("./zh-CN-XVEU3kbj.js"),__vite__mapDeps([])).then(r=>r.default)}}const D=ce()(t=>({setLocale:async r=>{const s=await we(r);t({locale:r,messages:s})}})),Fe=()=>{const t=D(l=>l.locale),r=D(l=>l.messages),s=D(l=>l.setLocale);return x.useLayoutEffect(()=>{t||s("zh-CN")},[t,s]),!r||!t?null:e.jsx(he,{locale:t,messages:r,children:e.jsx(me,{value:{fetcher:ke,revalidateOnFocus:!0,revalidateOnMount:!0,revalidateOnReconnect:!0,revalidateIfStale:!1},children:e.jsx(fe,{locale:{locale:t},theme:{token:{colorPrimary:"#7939cb",borderRadius:2,fontSize:16}},children:e.jsx(Q,{style:{minHeight:"100vh"},children:e.jsx(Q,{children:e.jsx(ve,{children:e.jsxs(xe,{children:[e.jsx(X,{path:"/nodeServerManagement",element:e.jsx(be,{})}),e.jsx(X,{path:"*",element:e.jsx(je,{to:"/nodeServerManagement"})})]})})})})})})})};de(document.getElementById("root")).render(e.jsx(ue.StrictMode,{children:e.jsx(pe,{children:e.jsx(Fe,{})})}));
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
